# FCinema – AI Agent Guide

> TL;DR: This Nx + pnpm monorepo hosts a single React-Vite frontend (`apps/fe-react-app`). The app talks to a Spring-Boot backend via auto-generated React-Query clients. Use **pnpm** commands (never npm/yarn) and Nx targets.

## Big Picture (read once)

1. **Frontend location** – all product code lives under `apps/fe-react-app/src`. Features are grouped in `feature/<domain>` (auth, booking, manager, …).
2. **Networking** – `src/utils/api.ts` exports `$api` (openapi-react-query). Domain-specific hooks in `src/services/**` wrap `$api` for components.
3. **Auth** – `AuthProvider` (cookie persistence) + `useAuth()` + `RoleRoute` enforce `ADMIN | STAFF | MEMBER` access rules.
4. **UI stack** – Tailwind + **Shadcn/ui**. Customized primitives reside in `src/components/Shadcn/` and `src/components/shared/`.
5. **Type safety** – the backend OpenAPI schema generates `schema-from-be.d.ts`; regenerate with `pnpm --filter fe-react-app generate-schema`.

## Daily Commands

```bash
# Start dev server with hot reload
pnpm exec nx run dev fe-react-app --disableNxCache --disableRemoteCache --verbose --outputStyle=static

# Typecheck / Build / Lint via Nx cache
pnpm exec nx run @fcinema-workspace/fe-react-app:typecheck --disableNxCache --disableRemoteCache --verbose --outputStyle=static
pnpm exec nx run @fcinema-workspace/fe-react-app:build --disableNxCache --disableRemoteCache --verbose --outputStyle=static
pnpm exec nx run @fcinema-workspace/fe-react-app:lint --disableNxCache --disableRemoteCache --verbose --outputStyle=static

# Vitest tests
pnpm exec nx run @fcinema-workspace/fe-react-app:vitest --disableNxCache --disableRemoteCache --verbose --outputStyle=static
```

Before running any command, ensure you had run `CI=true pnpm install` to sync dependencies.
Alway run in --disableNxCache --disableRemoteCache --verbose --outputStyle=static mode
Alway run typecheck build lint successfully before give the user the respond

## Gotchas & Conventions

- Don't need to manually do useMemo because the source code is already bundled by babel-plugin-react-compiler
- Use the `@/` import alias instead of long relative paths (configured in `tsconfig.json` & `vite.config.js`).
- Keep **feature** code UI-only; put data access in **services**.
- Components = PascalCase; utilities = camelCase.
- When adding a Shadcn component, edit `components.json` then run `pnpm shadcn-ui add`.
- Regenerate OpenAPI types after _any_ backend contract change or CI will fail.
- Never call `fetch` directly – always go through `$api` or a service hook to keep React Query cache coherent.
- Protected pages must be wrapped by `RoleRoute`. Example: `src/feature/auth/RoleRoute.tsx`.

## Nx Tips

- Visualize the dependency graph: `pnpm nx graph` (or `--focus fe-react-app`).
- Prefer `pnpm nx <target> fe-react-app` over package.json scripts for deterministic, cached runs.
- CI leverages Nx remote cache (see `nx.json`).

## External Services

- Backend: `https://fcinema-spring-ujhbb.ondigitalocean.app/movie_theater`.
- Cloudflare R2 handles asset uploads (`src/utils/cloudflare.utils.ts`).

## MCP

- ALWAY add use context7 at the end of every prompt

// This file is automatically generated by Nx Console

You are in an nx workspace using Nx 21.3.2 and pnpm as the package manager.

You have access to the Nx MCP server and the tools it provides. Use them. Follow these guidelines in order to best help the user:

### General Guidelines

- When answering questions, use the nx_workspace tool first to gain an understanding of the workspace architecture
- For questions around nx configuration, best practices or if you're unsure, use the nx_docs tool to get relevant, up-to-date docs!! Always use this instead of assuming things about nx configuration
- If the user needs help with an Nx configuration or project graph error, use the 'nx_workspace' tool to get any errors
- To help answer questions about the workspace structure or simply help with demonstrating how tasks depend on each other, use the 'nx_visualize_graph' tool

#### Generation Guidelines

If the user wants to generate something, use the following flow:

- learn about the nx workspace and any specifics the user needs by using the 'nx_workspace' tool and the 'nx_project_details' tool if applicable
- get the available generators using the 'nx_generators' tool
- decide which generator to use. If no generators seem relevant, check the 'nx_available_plugins' tool to see if the user could install a plugin to help them
- get generator details using the 'nx_generator_schema' tool
- you may use the 'nx_docs' tool to learn more about a specific generator or technology if you're unsure
- decide which options to provide in order to best complete the user's request. Don't make any assumptions and keep the options minimalistic
- open the generator UI using the 'nx_open_generate_ui' tool
- wait for the user to finish the generator
- read the generator log file using the 'nx_read_generator_log' tool
- use the information provided in the log file to answer the user's question or continue with what they were doing

### Running Tasks Guidelines

If the user wants help with tasks or commands (which include keywords like "test", "build", "lint", or other similar actions), use the following flow:

- Use the 'nx_current_running_tasks_details' tool to get the list of tasks (this can include tasks that were completed, stopped or failed).
- If there are any tasks, ask the user if they would like help with a specific task then use the 'nx_current_running_task_output' tool to get the terminal output for that task/command
- Use the terminal output from 'nx_current_running_task_output' to see what's wrong and help the user fix their problem. Use the appropriate tools if necessary
- If the user would like to rerun the task or command, always use `nx run <taskId>` to rerun in the terminal. This will ensure that the task will run in the nx context and will be run the same way it originally executed
- If the task was marked as "continuous" do not offer to rerun the task. This task is already running and the user can see the output in the terminal. You can use 'nx_current_running_task_output' to get the output of the task to verify the output.

---

_Update this file when workflows or folder structures change._
